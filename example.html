<!DOCTYPE html>
<html>
  <head lang="en">
    <meta charset="UTF-8">
    <title>Yjs test</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js"></script>
    <script src="bower_components/webcomponentsjs/webcomponents.js"></script>
    <script src="bower_components/yjs/y.js"></script>
    <script src="bower_components/yjs/y-object.js"></script>
    <script src="bower_components/y-list/y-list.js"></script>
    <script src="bower_components/y-xml/y-xml.js"></script>
    <script src="bower_components/y-webrtc/y-webrtc.js"></script>
    <script src="config.js"></script>
  </head>
  <body>
    <div id="shared_div">
      <h1> yjs HTML </h1>
      <p> Collaborative editing on HTML with <a href="https://github.com/rwth-acis/yjs/">yjs</a>
	and WebRTC Connector. </p>
      <p> Everything that is in the #shared_div is shared among the peers. You can modify the dom directly or use jquery. Here are some things you could try: </p>
      <pre> document.querySelector("#shared_div").setAttribute("style","color:blue")</pre>
      <pre> $("#shared_div").attr("style","color:red")</pre>
      <pre> $("#shared_div p").after("&lt;p&gt;After every p element.&lt;/p&gt;")</pre>
      <p> <a href="https://github.com/rwth-acis/yjs/">yjs</a> is a Framework for Real-Time collaboration on arbitrary data types.
      </p>
    </div>
  </body>
  <script>
   connector = new Y.WebRTC("xml-webrtc-example", {url: config.server});
   connector.debug = true;
   y = new Y(connector);
   window.onload = function(){
     connector.whenSynced(function(){
       if(y.val("dom") == null){
	 // check if dom was already assigned
	 window.shared_div = document.querySelector("#shared_div");
	 y.val("dom", new Y.Xml(window.shared_div));
       }
       var p = document.createElement("b")
       shared_div.insertBefore(p,null)
     })
     y.observe(function(events){
       for(i in events){
	 if(events[i].type === "add" || events[i].type === "update"){
	   // Everytime the "dom" is replaced, remove the old one from the body and but the new one there instead
	   document.querySelector("#shared_div").remove();
	   window.shared_div = y.val("dom").getDom();
	   var body = document.querySelector("body");
	   body.insertBefore(window.shared_div, body.firstChild);
	 }
       }
     })
   };
  </script>
</html>
