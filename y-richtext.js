!function t(e,r,o){function n(i,u){if(!r[i]){if(!e[i]){var l="function"==typeof require&&require;if(!u&&l)return l(i,!0);if(s)return s(i,!0);throw new Error("Cannot find module '"+i+"'")}var c=r[i]={exports:{}};e[i][0].call(c.exports,function(t){var r=e[i][1][t];return n(r?r:t)},c,c.exports,t,e,r,o)}return r[i].exports}for(var s="function"==typeof require&&require,i=0;i<o.length;i++)n(o[i]);return n}({1:[function(t,e,r){var o,n,s,i={}.hasOwnProperty,u=function(t,e){function r(){this.constructor=t}for(var o in e)i.call(e,o)&&(t[o]=e[o]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t};s=t("./misc.coffee").locker,o=function(){function t(t){this.editor=t}return t.prototype.getContents=function(){throw new Error("Implement me")},t.prototype.getCursor=function(){throw new Error("Implement me")},t.prototype.setCursor=function(t){throw new Error("Implement me")},t.prototype.observeLocalText=function(t){throw new Error("Implement me")},t.prototype.observeLocalCursor=function(t){throw new Error("Implement me")},t.prototype.updateContents=function(t){throw new Error("Implement me")},t}(),n=function(t){function e(t){this.editor=t,e.__super__.constructor.call(this,this.editor),this._cursors=this.editor.getModule("multi-cursor")}return u(e,t),e.prototype.getCursorPosition=function(){var t;return t=this.editor.getSelection(),t?t.start:0},e.prototype.getContents=function(){return this.editor.getContents()},e.prototype.setCursor=function(t){return s(this,t,function(t){return function(e){return t._cursors.setCursor(e.id,e.index,e.text,e.color)}}(this))},e.prototype.observeLocalText=function(t){return s(this,t,function(t){return function(e){return t.editor.on("text-change",function(t,r){return e(t),console.log(t)})}}(this))},e.prototype.observeLocalCursor=function(t){return s(this,t,function(t){return function(e){return t.editor.on("selection-change",function(t,r){return console.log("api"===r?"changed by backend":"changed by user"),t&&t.start===t.end?(e(t.start),console.log(t.start)):void 0})}}(this))},e.prototype.updateContents=function(t){return s(this,t,function(t){return function(e){return t.editor.updateContents(e)}}(this))},e}(o),r.QuillJs=n},{"./misc.coffee":2}],2:[function(t,e,r){var o,n,s=[].slice;n=function(){var t,e,r,o,n;return n=arguments[0],e=3<=arguments.length?s.call(arguments,1,o=arguments.length-1):(o=1,[]),t=arguments[o++],n.locker?void 0:(n.locker=!0,r=t.apply(null,e),n.locker=!1,r)},o=function(){function t(){this._tmp_model={}}return t.prototype._get=function(t){return null==this._model?this._tmp_model[t]:this._model.val(t)},t.prototype._set=function(t,e){return null==this._model?this._tmp_model[t]=e:this._model.val(t,e)},t.prototype._getModel=function(t,e){var r,o,n,s;if(null==this._model){this._model=new e.MapManager(this).execute(),n=this._tmp_model,s=[];for(r in n)o=n[r],s.push(this._model.val(r,o));return s}},t.prototype._setModel=function(t){return this._model=t,delete this._tmp_model},t}(),"undefined"!=typeof e&&null!==e&&(r.BaseClass=o,r.locker=n)},{}],3:[function(t,e,r){var o,n,s,i,u=function(t,e){return function(){return t.apply(e,arguments)}},l={}.hasOwnProperty,c=function(t,e){function r(){this.constructor=t}for(var o in e)l.call(e,o)&&(t[o]=e[o]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t};if(o=t("./misc.coffee").BaseClass,i=t("./misc.coffee").locker,n=t("./editors.coffee"),s=function(t){function e(){this.updateCursorPosition=u(this.updateCursorPosition,this),this.passDeltas=u(this.passDeltas,this)}return c(e,t),e.prototype.bind=function(t,e){var r,o,s,i,u,l,c,p;if(r=n[t],null!=r){for(this.editor=new r(e),this.editor.editor.deleteText(0,this.editor.editor.getText().length),this.editor.updateContents({ops:[{insert:this._get("characters").val().join("")}]}),o=0,u=[],p=this._get("selections").getSelections(this._get("characters")),l=0,c=p.length;c>l;l++)s=p[l],i=s.to-s.from,o!==s.from&&u.push({retain:s.from-o}),u.push({retain:i,attributes:s.attrs}),o+=i;return this.editor.updateContents({ops:u}),this.editor.observeLocalText(this.passDeltas),this.bindEventsToEditor(this.editor),this.editor.observeLocalCursor(this.updateCursorPosition)}throw new Error("This type of editor is not supported!")},e.prototype._getModel=function(t,r){return null==this._model&&(e.__super__._getModel.apply(this,arguments),this._set("selections",new t.Selections),this._set("characters",new t.List),this._set("cursors",new t.Object),this._setModel(this._model),this._model.observe(this.propagateToEditor)),this._model},e.prototype._setModel=function(t){return e.__super__._setModel.apply(this,arguments)},e.prototype._name="RichText",e.prototype.setCursor=function(t){return this.selfCursor=this._get("characters").ref(t),this._get("cursors").val(this._model.HB.getUserId(),this.selfCursor)},e.prototype.passDeltas=function(t){return i(this,t,function(t){return function(e){var r,o,n,s,i,u;for(o=0,i=e.ops,u=[],n=0,s=i.length;s>n;n++)r=i[n],u.push(o=t.deltaHelper(r,o));return u}}(this))},e.prototype.updateCursorPosition=function(t){return i(this,t,function(t){return function(e){return t.selfCursor="number"==typeof e?t._get("characters").ref(e):e,t._get("cursors").val(t._model.HB.getUserId(),t.selfCursor)}}(this))},e.prototype.bindEventsToEditor=function(t){return this._get("characters").observe(function(t){return function(e){return i(t,e,function(e){var r,o,n,s,i;for(i=[],n=0,s=e.length;s>n;n++)o=e[n],r={ops:[{retain:o.position}]},"insert"===o.type?r.ops.push({insert:o.value}):"delete"===o.type&&r.ops.push({"delete":1}),i.push(t.editor.updateContents(r));return i})}}(this)),this._get("selections").observe(function(t){return function(e){return i(t,e,function(e){var r,o,n,s,i,u,l,c,p;if(o={},"select"===e.type){c=e.attrs;for(r in c)i=c[r],o[r]=i}else for(p=e.attrs,u=0,l=p.length;l>u;u++)r=p[u],o[r]=null;return n=e.from.getPosition(),s=e.to.getPosition()-e.from.getPosition(),t.editor.updateContents({ops:[{retain:n},{retain:s,attributes:o}]})})}}(this)),this._get("cursors").observe(function(t){return function(e){return i(t,e,function(e){var r,o,n,s,i,u,l;for(l=[],i=0,u=e.length;u>i;i++)o=e[i],r=o.changedBy,s=o.object.val(r),null!==s?(n={id:r,index:o.object.val(r).getPosition(),text:r,color:"grey"},l.push(t.editor.setCursor(n))):l.push(void 0);return l})}}(this))},e.prototype.deltaHelper=function(t,e){var r,o,n,s,i,u,l,c,p;if(null==e&&(e=0),null!=t){u=this._get("selections"),o=[],r={},p=t.attributes;for(s in p)c=p[s],null!=c?r[s]=c:o.push(s);if(null!=t.insert)return this.insertHelper(e,t.insert),n=this._get("characters").ref(e),l=this._get("characters").ref(e+t.insert.length),this._get("selections").select(n,l,r),this._get("selections").unselect(n,l,o),e+t.insert.length;if(null!=t["delete"])return this.deleteHelper(e,t["delete"]),e;if(null!=t.retain)return i=parseInt(t.retain),n=this._get("characters").ref(e),l=this._get("characters").ref(e+i),this._get("selections").select(n,l,r),this._get("selections").unselect(n,l,o),e+i;throw new Error("This part of code must not be reached!")}},e.prototype.insertHelper=function(t,e){var r;return r="string"==typeof e?e.split(""):"number"==typeof e?[e]:void 0,null!=r?this._get("characters").insertContents(t,r):void 0},e.prototype.deleteHelper=function(t,e){return null==e&&(e=1),console.log("deleteHelper"),this._get("characters")["delete"](t,e)},e}(o),"undefined"!=typeof window&&null!==window){if(null==window.Y)throw new Error("You must first import Y!");window.Y.RichText=s}"undefined"!=typeof e&&null!==e&&(e.exports=s)},{"./editors.coffee":1,"./misc.coffee":2}]},{},[3]);