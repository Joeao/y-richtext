!function t(e,o,r){function n(s,u){if(!o[s]){if(!e[s]){var l="function"==typeof require&&require;if(!u&&l)return l(s,!0);if(i)return i(s,!0);throw new Error("Cannot find module '"+s+"'")}var c=o[s]={exports:{}};e[s][0].call(c.exports,function(t){var o=e[s][1][t];return n(o?o:t)},c,c.exports,t,e,o,r)}return o[s].exports}for(var i="function"==typeof require&&require,s=0;s<r.length;s++)n(r[s]);return n}({1:[function(t,e,o){var r,n,i,s,u={}.hasOwnProperty,l=function(t,e){function o(){this.constructor=t}for(var r in e)u.call(e,r)&&(t[r]=e[r]);return o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype,t};n=t("./misc.coffee").Locker,r=function(){function t(t){this.editor=t,this.locker=new n}return t.prototype.getContents=function(){throw new Error("Implement me")},t.prototype.getCursor=function(){throw new Error("Implement me")},t.prototype.setCursor=function(t){throw new Error("Implement me")},t.prototype.observeLocalText=function(t){throw new Error("Implement me")},t.prototype.observeLocalCursor=function(t){throw new Error("Implement me")},t.prototype.updateContents=function(t){throw new Error("Implement me")},t}(),i=function(t){function e(t){this.editor=t,e.__super__.constructor.call(this,this.editor),this._cursors=this.editor.getModule("multi-cursor")}return l(e,t),e.prototype.getCursorPosition=function(){var t;return t=this.editor.getSelection(),t?t.start:0},e.prototype.getContents=function(){return this.editor.getContents()},e.prototype.setCursor=function(t){return this.locker["try"](function(e){return function(){return e._cursors.setCursor(t.id,t.index,t.text,t.color)}}(this))},e.prototype.observeLocalText=function(t){return this.editor.on("text-change",function(e,o){var r;return r=t(e.ops),this.editor.selection.emitter.emit(this.editor.selection.emitter.constructor.events.SELECTION_CHANGE,this.editor.quill.getSelection(),"user")})},e.prototype.observeLocalCursor=function(t){return this.editor.on("selection-change",function(e,o){return e&&e.start===e.end?(t(e.start),console.log(e.start)):void 0})},e.prototype.updateContents=function(t){return this.editor.updateContents(t)},e}(r),s=function(t){function e(t){this.editor=t,e.__super__.constructor.apply(this,arguments)}return l(e,t),e.prototype.getCursorPosition=function(){return 0},e.prototype.getContents=function(){return{ops:[{insert:"Well, this is a test!"},{insert:"And I'm boldâ€¦",attributes:{bold:!0}}]}},e.prototype.setCursor=function(){return""},e.prototype.observeLocalText=function(t){return""},e.prototype.observeLocalCursor=function(t){return""},e.prototype.updateContents=function(t){return""},e}(r),o.QuillJs=i,o.TestEditor=s},{"./misc.coffee":2}],2:[function(t,e,o){var r,n;n=function(){function t(){this.is_locked=!1}return t.prototype["try"]=function(t){var e;if(!this.is_locked)return this.is_locked=!0,e=t(),this.is_locked=!1,e},t}(),r=function(){function t(){this._tmp_model={}}return t.prototype._get=function(t){return null==this._model?this._tmp_model[t]:this._model.val(t)},t.prototype._set=function(t,e){return null==this._model?this._tmp_model[t]=e:this._model.val(t,e)},t.prototype._getModel=function(t,e){var o,r,n;if(null==this._model){this._model=new e.MapManager(this).execute(),n=this._tmp_model;for(o in n)r=n[o],this._model.val(o,r)}return this._model},t.prototype._setModel=function(t){return this._model=t,delete this._tmp_model},t}(),"undefined"!=typeof e&&null!==e&&(o.BaseClass=r,o.Locker=n)},{}],3:[function(t,e,o){var r,n,i,s,u=function(t,e){return function(){return t.apply(e,arguments)}},l={}.hasOwnProperty,c=function(t,e){function o(){this.constructor=t}for(var r in e)l.call(e,r)&&(t[r]=e[r]);return o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype,t};if(r=t("./misc.coffee").BaseClass,i=t("./misc.coffee").Locker,n=t("./editors.coffee"),s=function(t){function e(){this.updateCursorPosition=u(this.updateCursorPosition,this),this.passDeltas=u(this.passDeltas,this),this.locker=new i}var o,r,s;return c(e,t),e.prototype.bind=function(t,e){var o,r,i,s,u,l,c,p;if(o=n[t],null!=o){for(this.editor=new o(e),this.editor.editor.deleteText(0,this.editor.editor.getText().length),this.editor.updateContents({ops:[{insert:this._model.getContent("characters").val().join("")}]}),r=0,u=[],p=this._model.getContent("selections").getSelections(this._model.getContent("characters")),l=0,c=p.length;c>l;l++)i=p[l],s=i.to-i.from,r!==i.from&&u.push({retain:i.from-r}),u.push({retain:s,attributes:i.attrs}),r+=s;return this.editor.updateContents({ops:u}),this.editor.observeLocalText(this.passDeltas),this.bindEventsToEditor(this.editor),this.editor.observeLocalCursor(this.updateCursorPosition)}throw new Error("This type of editor is not supported!")},e.prototype._getModel=function(t,e){var o;return null==this._model&&(o={selections:new t.Selections,characters:new t.List,cursors:new t.Object},this._model=new e.MapManager(this,null,{},o).execute(),this._setModel(this._model),this._model.observe(this.propagateToEditor)),this._model},e.prototype._setModel=function(t){return e.__super__._setModel.apply(this,arguments)},e.prototype._name="RichText",e.prototype.setCursor=function(t){return this.selfCursor=this._model.getContent("characters").ref(t),this._model.getContent("cursors").val(this._model.HB.getUserId(),this.selfCursor)},e.prototype.passDeltas=function(t){return this.locker["try"](function(e){return function(){var o,n,i,s,u;for(n=0,u=[],i=0,s=t.length;s>i;i++)o=t[i],u.push(n=r(e,o,n));return u}}(this))},e.prototype.updateCursorPosition=function(t){return this.locker["try"](function(e){return function(){return e.selfCursor="number"==typeof t?e._model.getContent("characters").ref(t):t,e._model.getContent("cursors").val(e._model.HB.getUserId(),e.selfCursor)}}(this))},e.prototype.bindEventsToEditor=function(t){return this._model.getContent("characters").observe(function(t){return function(e){return t.locker["try"](function(){var o,r,n,i,s;for(s=[],n=0,i=e.length;i>n;n++)r=e[n],o={ops:[{retain:r.position}]},"insert"===r.type?o.ops.push({insert:r.value}):"delete"===r.type&&o.ops.push({"delete":1}),s.push(t.editor.updateContents(o));return s})}}(this)),this._model.getContent("selections").observe(function(t){return function(e){return t.locker["try"](function(){var o,r,n,i,s,u,l,c,p;if(r={},"select"===e.type){c=e.attrs;for(o in c)s=c[o],r[o]=s}else for(p=e.attrs,u=0,l=p.length;l>u;u++)o=p[u],r[o]=null;return n=e.from.getPosition(),i=e.to.getPosition()-e.from.getPosition(),t.editor.updateContents({ops:[{retain:n},{retain:i,attributes:r}]})})}}(this)),this._model.getContent("cursors").observe(function(t){return function(e){return t.locker["try"](function(){var o,r,n,i,s,u,l;for(l=[],s=0,u=e.length;u>s;s++)r=e[s],o=r.changedBy,i=r.object.val(o),null!=i?(n={id:o,index:i,text:o,color:"grey"},l.push(t.editor.setCursor(n))):l.push(void 0);return l})}}(this))},r=function(t,e,r){var n,i,u,l,c,p,f,d,h;if(null==r&&(r=0),null!=e){p=t._model.getContent("selections"),i=[],n={},h=e.attributes;for(l in h)d=h[l],null!=d?n[l]=d:i.push(l);if(null!=e.insert)return s(t,r,e.insert),u=t._model.getContent("characters").ref(r),f=t._model.getContent("characters").ref(r+e.insert.length),t._model.getContent("selections").select(u,f,n),t._model.getContent("selections").unselect(u,f,i),r+e.insert.length;if(null!=e["delete"])return o(t,r,e["delete"]),r;if(null!=e.retain)return c=parseInt(e.retain),u=t._model.getContent("characters").ref(r),f=t._model.getContent("characters").ref(r+c),t._model.getContent("selections").select(u,f,n),t._model.getContent("selections").unselect(u,f,i),r+c;throw new Error("This part of code must not be reached!")}},s=function(t,e,o){var r;return r="string"==typeof o?o.split(""):"number"==typeof o?[o]:void 0,null!=r?t._model.getContent("characters").insertContents(e,r):void 0},o=function(t,e,o){return null==o&&(o=1),t._model.getContent("characters")["delete"](e,o)},e}(r),"undefined"!=typeof window&&null!==window){if(null==window.Y)throw new Error("You must first import Y!");window.Y.RichText=s}"undefined"!=typeof e&&null!==e&&(e.exports=s)},{"./editors.coffee":1,"./misc.coffee":2}]},{},[3]);