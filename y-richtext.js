!function t(e,r,n){function o(a,s){if(!r[a]){if(!e[a]){var l="function"==typeof require&&require;if(!s&&l)return l(a,!0);if(i)return i(a,!0);var c=new Error("Cannot find module '"+a+"'");throw c.code="MODULE_NOT_FOUND",c}var u=r[a]={exports:{}};e[a][0].call(u.exports,function(t){var r=e[a][1][t];return o(r?r:t)},u,u.exports,t,e,r,n)}return r[a].exports}for(var i="function"==typeof require&&require,a=0;a<n.length;a++)o(n[a]);return o}({1:[function(t,e,r){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function i(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function a(t){t.requestModules(["Array"]).then(function(){var e=function(e){function r(t,e,i){n(this,r);var a=o(this,Object.getPrototypeOf(r).call(this,t,e,i));a._length=0,a.instances=[];for(var s=0;s<i.length;s++){var l=l=i[s].val;"string"==typeof l&&a._length++}var c=a;return a.observe(function(t){for(var e=0,r=t[e];e<t.length;e++)"insert"===r.type?"string"==typeof r.value&&c._length++:"delete"===r.type&&"string"==typeof r.value&&c._length--}),a}return i(r,e),s(r,[{key:"toString",value:function(){return this._content.map(function(t){return"string"==typeof t.val?t.val:void 0}).join("")}},{key:"toOTOps",value:function(){function t(){var t={};for(var e in r.attributes)t[e]=r.attributes[e];r={insert:[],attributes:t}}for(var e=[],r={insert:[],attributes:{}},n=0;n<this._content.length;n++){var o=this._content[n].val;o.constructor===Array?(r.insert.length>0&&(r.insert=r.insert.join(""),e.push(r),t()),null===o[1]?delete r.attributes[o[0]]:r.attributes[o[0]]=o[1]):r.insert.push(o)}return r.insert.length>0&&(r.insert=r.insert.join(""),e.push(r)),e}},{key:"insert",value:function(t,e){for(var n=0,o={},i=0;i<this._content.length&&n!==t;i++){var a=this._content[i].val;"string"==typeof a?n++:a.constructor===Array&&(null===a[1]?delete o[a[0]]:o[a[0]]=a[1])}return l(Object.getPrototypeOf(r.prototype),"insert",this).call(this,i,e.split("")),o}},{key:"delete",value:function(t,e){var n=0,o={},i=t+e;if(!(0>=e)){var a,s,c,u;for(a=0;t>n&&a<this._content.length;a++)c=this._content[a].val,"string"==typeof c?n++:c.constructor===Array&&(o[c[0]]=c[1]);for(s=a;i>n&&s<this._content.length;s++)c=this._content[s].val,"string"==typeof c&&n++;if(s===this._content.length)for(u=s-1;u>=a;u--)c=this._content[u].val,l(Object.getPrototypeOf(r.prototype),"delete",this).call(this,u,1);else{"string"==typeof c&&s--;var f={};for(u=s;u>=a;u--)c=this._content[u].val,c.constructor===Array?void 0===f[c[0]]?(c[1]===o[c[0]]&&l(Object.getPrototypeOf(r.prototype),"delete",this).call(this,u,1),f[c[0]]=c[1]):l(Object.getPrototypeOf(r.prototype),"delete",this).call(this,u,1):"string"==typeof c&&l(Object.getPrototypeOf(r.prototype),"delete",this).call(this,u,1)}}}},{key:"select",value:function(t,e,n,o){if(null==t||null==e||null==n||void 0===o)throw new Error("You must define four parameters");for(var i,a,s=[n,null],c=0,u=0;u<this._content.length;u++){var f=this._content[u].val;if(c===t)break;f.constructor===Array?f[0]===n&&(s[1]=f[1]):"string"==typeof f&&c++}s[1]!==o&&(i=u,a=[n,o]);for(var h=[];u<this._content.length;u++){var p=this._content[u].val;if(c===e)break;p.constructor===Array?p[0]===n&&(s[1]=p[1],h.push(u)):"string"==typeof p&&c++}for(var v=h.length-1;v>=0;v--){var y=h[v];l(Object.getPrototypeOf(r.prototype),"delete",this).call(this,y,1),u>y&&u--,i>y&&i--}if(s[1]!==o&&u<this._content.length){var g,d=!0;for(v=u;v<this._content.length&&(g=this._content[v].val,g.constructor===Array);v++)if(g[0]===n){d=!1,g[1]===o&&l(Object.getPrototypeOf(r.prototype),"delete",this).call(this,v,1);break}if(d){var b=[n,s[1]];l(Object.getPrototypeOf(r.prototype),"insert",this).call(this,u,[b])}}if(null!=i)for(l(Object.getPrototypeOf(r.prototype),"insert",this).call(this,i,[a]),v=i-1;v>=0&&(g=this._content[v].val,g.constructor===Array);v--)g[0]===n&&l(Object.getPrototypeOf(r.prototype),"delete",this).call(this,v,1)}},{key:"bind",value:function(t){function e(t){if(n){n=!1;try{t()}catch(e){throw n=!0,new Error(e)}n=!0}}this.instances.push(t);var r=this,n=!0;t.setContents(this.toOTOps()),t.on("text-change",function(n){e(function(){for(var e,o=0,i=0;i<n.ops.length;i++){var a=n.ops[i];if(null!=a.insert){var s=r.insert(o,a.insert);for(e in a.attributes)a.attributes[e]!==s[e]&&r.select(o,o+a.insert.length,e,a.attributes[e]);for(e in s)(null==a.attributes||s[e]!==a.attributes[e])&&r.select(o,o+a.insert.length,e,null);o+=a.insert.length}if(null!=a["delete"]&&r["delete"](o,a["delete"]),null!=a.retain){var l=o+a.retain;if(l>r.length){var c=t.getText(r.length);t.insertText(r.length,c);for(e in a.attributes)t.formatText(r.length+c.length,r.length+2*c.length,e,null);r.insert(r.length,c)}for(e in a.attributes)r.select(o,o+a.retain,e,a.attributes[e]),t.formatText(o,o+a.retain,e,a.attributes[e]);o=l}}})}),this.observe(function(n){e(function(){for(var e,o,i=0;i<n.length;i++){var a=n[i];if("insert"===a.type){if("string"==typeof a.value){for(var s=0,l={},c=a.index-1;c>=0;c--)e=r._content[c].val,"string"==typeof e?s++:e.constructor===Array&&"undefined"==typeof l[e[0]]&&(l[e[0]]=e[1]);t.insertText(s,a.value,l)}else if(a.value.constructor===Array){o=null;for(var u=a.value,f=0,h=a.index-1;h>=0;h--)if(e=r._content[h].val,e.constructor===Array){if(u[0]===e[0]){o=e[1];break}}else"string"==typeof e&&f++;for(;h>=0;h--)e=r._content[h].val,"string"==typeof e&&f++;if(u[1]===o)return;for(var p=f,v=a.index+1;v<r._content.length;v++)if(e=r._content[v].val,e.constructor===Array){if(e[0]===u[0])break}else"string"==typeof e&&p++;f!==p&&t.formatText(f,p,u[0],u[1])}}else if("delete"===a.type)if("string"==typeof a.value){for(var y=0,g=0;g<a.index;g++)e=r._content[g].val,"string"==typeof e&&y++;var d=a.length;t.deleteText(y,y+d)}else if(a.value.constructor===Array){o=null;var b,_=0;for(b=a.index-1;b>=0;b--)if(e=r._content[b].val,e.constructor===Array){if(e[0]===a.value[0]){o=e[1];break}}else"string"==typeof e&&_++;for(;b>=0;b--)e=r._content[b].val,"string"==typeof e&&_++;var O=_;for(b=a.index;b<r._content.length;b++)if(e=r._content[b].val,e.constructor===Array){if(e[0]===a.value[0])break}else"string"==typeof e&&O++;o!==a.value[1]&&_!==O&&t.formatText(_,O,a.value[0],o)}}t.editor.checkUpdate()})})}},{key:"_changed",value:regeneratorRuntime.mark(function a(){var e=arguments;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return this.instances.forEach(function(t){t.editor.checkUpdate()}),r.delegateYield(t.Array["class"].prototype._changed.apply(this,e),"t0",2);case 2:case"end":return r.stop()}},a,this)})},{key:"length",get:function(){return this.toString().length}}]),r}(t.Array["class"]);t.extend("Richtext",new t.utils.CustomType({name:"Richtext","class":e,struct:"List",initType:regeneratorRuntime.mark(function r(n,o){var i;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.delegateYield(t.Struct.List.map.call(this,o,function(t){return{id:JSON.stringify(t.id),val:t.content}}),"t0",1);case 1:return i=r.t0,r.abrupt("return",new e(n,o.id,i));case 3:case"end":return r.stop()}},r,this)})}))})}var s=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),l=function c(t,e,r){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,e);if(void 0===n){var o=Object.getPrototypeOf(t);return null===o?void 0:c(o,e,r)}if("value"in n)return n.value;var i=n.get;if(void 0!==i)return i.call(r)};e.exports=a,"undefined"!=typeof Y&&a(Y)},{}]},{},[1]);
//# sourceMappingURL=y-richtext.js.map
