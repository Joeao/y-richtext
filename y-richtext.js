!function t(r,e,n){function i(o,l){if(!e[o]){if(!r[o]){var s="function"==typeof require&&require;if(!l&&s)return s(o,!0);if(a)return a(o,!0);var u=new Error("Cannot find module '"+o+"'");throw u.code="MODULE_NOT_FOUND",u}var f=e[o]={exports:{}};r[o][0].call(f.exports,function(t){var e=r[o][1][t];return i(e?e:t)},f,f.exports,t,r,e,n)}return e[o].exports}for(var a="function"==typeof require&&require,o=0;o<n.length;o++)i(n[o]);return i}({1:[function(t,r,e){"use strict";function n(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function i(t,r){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!r||"object"!=typeof r&&"function"!=typeof r?t:r}function a(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function, not "+typeof r);t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),r&&(Object.setPrototypeOf?Object.setPrototypeOf(t,r):t.__proto__=r)}function o(t){t.requestModules(["Array"]).then(function(){var r=function(t){function r(t,e,a,o){n(this,r);var l=i(this,Object.getPrototypeOf(r).call(this,t,e,a,o));l._length=0;for(var s=0,u=o[s];s<o.length;s++)"string"==typeof u&&l._length++;var f=l;return l.observe(function(t){for(var r=0,e=t[r];r<t.length;r++)"insert"===e.type?"string"==typeof e.value&&f._length++:"delete"===e.type&&"string"==typeof e.value&&f._length--}),l}return a(r,t),l(r,[{key:"toString",value:function(){return this.valArray.map(function(t){return"string"==typeof t?t:void 0}).join("")}},{key:"toOTOps",value:function(){function t(){var t={};for(var r in e.attributes)t[r]=e.attributes[r];e={insert:[],attributes:t}}for(var r=[],e={insert:[],attributes:{}},n=0;n<this.valArray.length;n++){var i=this.valArray[n];i.constructor===Array?(e.insert.length>0&&(e.insert=e.insert.join(""),r.push(e),t()),null===i[1]?delete e.attributes[i[0]]:e.attributes[i[0]]=i[1]):e.insert.push(i)}return e.insert.length>0&&(e.insert=e.insert.join(""),r.push(e)),r}},{key:"insert",value:function(t,e){for(var n=0,i={},a=0;a<this.valArray.length&&n!==t;a++){var o=this.valArray[a];"string"==typeof o?n++:o.constructor===Array&&(null===o[1]?delete i[o[0]]:i[o[0]]=o[1])}return s(Object.getPrototypeOf(r.prototype),"insert",this).call(this,a,e.split("")),i}},{key:"delete",value:function(t,e){var n=0,i={},a=t+e;if(!(0>=e)){var o,l,u;for(o=0,u=this.valArray[o];t>n&&o<this.valArray.length;u=this.valArray[++o])"string"==typeof u?n++:u.constructor===Array&&(i[u[0]]=u[1]);for(l=o,u=this.valArray[l];a>n&&l<this.valArray.length;u=this.valArray[++l])"string"==typeof u&&n++;if(l===this.valArray.length)for(var f=l-1,u=this.valArray[f];f>=o;u=this.valArray[--f])s(Object.getPrototypeOf(r.prototype),"delete",this).call(this,f,1);else{"string"==typeof u&&l--;for(var c={},f=l,u=this.valArray[f];f>=o;u=this.valArray[--f])u.constructor===Array?void 0===c[u[0]]?(u[1]===i[u[0]]&&s(Object.getPrototypeOf(r.prototype),"delete",this).call(this,f,1),c[u[0]]=u[1]):s(Object.getPrototypeOf(r.prototype),"delete",this).call(this,f,1):"string"==typeof u&&s(Object.getPrototypeOf(r.prototype),"delete",this).call(this,f,1)}}}},{key:"select",value:function(t,e,n,i){if(void 0===i)throw new Error("You must define four parameters");for(var a,o,l=[n,null],u=0,f=0;f<this.valArray.length;f++){var c=this.valArray[f];if(u===t)break;c.constructor===Array?c[0]===n&&(l[1]=c[1]):"string"==typeof c&&u++}l[1]!==i&&(a=f,o=[n,i]);for(var y=[];f<this.valArray.length;f++){var v=this.valArray[f];if(u===e)break;v.constructor===Array?v[0]===n&&(l[1]=v[1],y.push(f)):"string"==typeof v&&u++}for(var h=y.length-1;h>=0;h--){var p=y[h];s(Object.getPrototypeOf(r.prototype),"delete",this).call(this,p,1),f>p&&f--,a>p&&a--}if(l[1]!==i&&f<this.valArray.length){var g,b=!0;for(h=f,g=this.valArray[h];h<this.valArray.length&&g.constructor===Array;g=this.valArray[++h])if(g[0]===n){b=!1,g[1]===i&&s(Object.getPrototypeOf(r.prototype),"delete",this).call(this,h,1);break}if(b){var A=[n,l[1]];s(Object.getPrototypeOf(r.prototype),"insert",this).call(this,f,[A])}}if(null!=a)for(s(Object.getPrototypeOf(r.prototype),"insert",this).call(this,a,[o]),h=a-1,g=this.valArray[h];h>=0&&g.constructor===Array;g=this.valArray[--h])g[0]===n&&s(Object.getPrototypeOf(r.prototype),"delete",this).call(this,h,1)}},{key:"bind",value:function(t){function r(t){if(n){n=!1;try{t()}catch(r){throw n=!0,new Error(r)}n=!0}}var e=this,n=!0;t.setContents(this.toOTOps()),t.on("text-change",function(n){r(function(){for(var r=0,i=0;i<n.ops.length;i++){var a=n.ops[i];if(null!=a.insert){var o=e.insert(r,a.insert);for(var l in a.attributes)a.attributes[l]!=o[l]&&e.select(r,r+a.insert.length,l,a.attributes[l]);for(var l in o)(null==a.attributes||o[l]!=a.attributes[l])&&e.select(r,r+a.insert.length,l,null);r+=a.insert.length}if(null!=a["delete"]&&e["delete"](r,a["delete"]),null!=a.retain){var s=r+a.retain;if(s>e.length){for(var u=s-e.length,f="";0!==u;)u--,f+="\n";for(var l in a.attributes)t.formatText(e.length,e.length+a.retain,l,null);t.insertText(e.length,f,a.attributes),e.insert(e.length,f)}for(var l in a.attributes)e.select(r,r+a.retain,l,a.attributes[l]);r=s}}})}),this.observe(function(n){r(function(){for(var r=0;r<n.length;r++){var i=n[r];if("insert"===i.type){if("string"==typeof i.value){for(var a=0,o={},l=i.index-1;l>=0;l--){var s=e.valArray[l];"string"==typeof s?a++:s.constructor===Array&&"undefined"==typeof o[s[0]]&&(o[s[0]]=s[1])}t.insertText(a,i.value,o)}else if(i.value.constructor===Array){for(var s,u=null,f=i.value,c=0,y=i.index-1;y>=0;y--)if(s=e.valArray[y],s.constructor===Array){if(f[0]===s[0]){u=s[1];break}}else"string"==typeof s&&c++;for(;y>=0;y--)s=e.valArray[y],"string"==typeof s&&c++;if(f[1]===u)return;for(var v=c,h=i.index+1;h<e.valArray.length;h++)if(s=e.valArray[h],s.constructor===Array){if(s[0]===f[0])break}else"string"==typeof s&&v++;c!==v&&t.formatText(c,v,f[0],f[1])}}else if("delete"===i.type)if("string"==typeof i.value){for(var p=0,g=0;g<i.index;g++){var s=e.valArray[g];"string"==typeof s&&p++}var b=i.length;t.deleteText(p,p+b)}else if(i.value.constructor===Array){for(var u=null,A=0,d=i.index-1;d>=0;d--){var s=e.valArray[d];if(s.constructor===Array){if(s[0]===i.value[0]){u=s[1];break}}else"string"==typeof s&&A++}for(;d>=0;s=e.valArray[--d])"string"==typeof s&&A++;for(var O=A,d=i.index;d<e.valArray.length;d++){var s=e.valArray[d];if(s.constructor===Array){if(s[0]===i.value[0])break}else"string"==typeof s&&O++}u!==i.value[1]&&A!==O&&t.formatText(A,O,i.value[0],u)}}})})}},{key:"length",get:function(){return this._length}}]),r}(t.Array["class"]);t.extend("Richtext",new t.utils.CustomType({name:"Richtext","class":r,struct:"List",initType:regeneratorRuntime.mark(function e(n,i){var a,o;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=[],e.delegateYield(t.Struct.List.map.call(this,i,function(t){return a.push(t.content),JSON.stringify(t.id)}),"t0",2);case 2:return o=e.t0,e.abrupt("return",new r(n,i.id,o,a));case 4:case"end":return e.stop()}},e,this)})}))})}var l=function(){function t(t,r){for(var e=0;e<r.length;e++){var n=r[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(r,e,n){return e&&t(r.prototype,e),n&&t(r,n),r}}(),s=function u(t,r,e){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,r);if(void 0===n){var i=Object.getPrototypeOf(t);return null===i?void 0:u(i,r,e)}if("value"in n)return n.value;var a=n.get;if(void 0!==a)return a.call(e)};r.exports=o,"undefined"!=typeof Y&&o(Y)},{}]},{},[1]);
//# sourceMappingURL=y-richtext.js.map
